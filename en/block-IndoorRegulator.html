<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>IndoorRegulator</title><link rel="stylesheet" type="text/css" href="css/style.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.76.1" /><link rel="home" href="index.html" title="" /><link rel="up" href="engineering.html" title="Engineering" /><link rel="prev" href="block-Curve.html" title="Absolute" /><link rel="next" href="block-ManualOverride.html" title="ManualOverride" />


<!-- favicon -->

<link rel="shortcut icon" href="http://www.bali.io/favicon.ico" type="image/vnd.microsoft.icon" />
<link rel="icon" href="http://www.bali.io/favicon.ico" type="image/x-icon" />

<!-- style -->

<link href="css/shCore.css" rel="stylesheet" type="text/css" />
<link href="css/shCoreEclipse.css" rel="stylesheet" type="text/css" />
<link href="css/shThemeEclipse.css" rel="stylesheet" type="text/css" />
<link href="css/balixo.css" rel="stylesheet" type="text/css" />

<!-- Syntax Highlighter -->

<script type="text/javascript" src="js/shCore.js"></script>
<script type="text/javascript" src="js/shBrushJava.js"></script>
<script type="text/javascript" src="js/shBrushJScript.js"></script>
<script type="text/javascript" src="js/shBrushBash.js"></script>
<script type="text/javascript" src="js/shBrushPlain.js"></script>
<script type="text/javascript" src="js/shBrushXml.js"></script>
<script type="text/javascript" src="js/shBrushGroovy.js"></script>
<script type="text/javascript" src="js/shBrushPython.js"></script>
<script type="text/javascript" src="js/shBrushRuby.js"></script>
<script type="text/javascript" src="js/shBrushCSharp.js"></script>

<script type="text/javascript">
  SyntaxHighlighter.defaults['tab-size'] = 4;
  SyntaxHighlighter.defaults['gutter'] = false;
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all()
</script>

<!-- JQuery -->

<script type="text/javascript" src="js/jquery-1.6.4.min.js"></script>

<!-- Image Scaler -->

<script type="text/javascript" src="js/imagescaler.js"></script>

<!-- Table Styler -->

<script type="text/javascript" src="js/tablestyler.js"></script>

<!-- Version Switcher -->

<script type="text/javascript" src="js/versionswitcher.js"></script>

<!-- WebSite Progressive Enhancement -->

<link href="css/progressive-enhancement.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/jquery.scrollTo-1.4.2.js"></script>
<script type="text/javascript" src="js/progressive-enhancement.js"></script>

<!-- Analytics -->
 <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-3118496-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
 </script>

  </head><body><div xmlns="" xmlns:exsl="http://exslt.org/common" class="logo"><a href="index.html"><img src="images/logo.png" /></a></div><div xmlns="" xmlns:exsl="http://exslt.org/common" class="top-nav"><div xmlns="http://www.w3.org/1999/xhtml" class="toc"><dl><dt><span class="section"><a href="index.html#_home">Home</a></span></dt><dt><span class="section"><a href="products.html">Products</a></span></dt><dt><span class="section"><a href="services.html">Services</a></span></dt><dt><span class="section"><a href="_manual.html">Manual</a></span></dt><dt><span class="section"><span xmlns="" href="engineering.html">Engineering</span></span></dt><dt><span class="section"><a href="company.html">Company</a></span></dt></dl></div></div><div xmlns="" xmlns:exsl="http://exslt.org/common" class="sub-nav"><div xmlns="http://www.w3.org/1999/xhtml" class="toc"><dl><dt><span class="section"><a href="engineering.html#doc-network">Networking</a></span></dt><dt><span class="section"><a href="doc-io.html">I/O Drivers</a></span></dt><dt><span class="section"><a href="programming.html">Programming</a></span></dt><dt><span class="section"><a href="doc-blocktypes.html">Block Types</a></span></dt><dt><span class="section"><a href="block-Absolute.html">Absolute</a></span></dt><dt><span class="section"><a href="block-Add4.html">Add4</a></span></dt><dt><span class="section"><a href="block-AlarmPoint.html">AlarmPoint</a></span></dt><dt><span class="section"><a href="block-AnalogInput.html">AnalogInput</a></span></dt><dt><span class="section"><a href="block-AutoManual.html">AutoManual</a></span></dt><dt><span class="section"><a href="block-Curve.html">Absolute</a></span></dt><dt><span class="section"><span xmlns="" href="block-IndoorRegulator.html">IndoorRegulator</span></span></dt><dt><span class="section"><a href="block-ManualOverride.html">ManualOverride</a></span></dt><dt><span class="section"><a href="block-Multiply4.html">Multiply4</a></span></dt><dt><span class="section"><a href="block-RangeCheck.html">RangeCheck</a></span></dt><dt><span class="section"><a href="block-RsLatch.html">RsLatch</a></span></dt><dt><span class="section"><a href="block-Subtract.html">Subtract</a></span></dt><dt><span class="section"><a href="block-YearSchedule.html">YearSchedule</a></span></dt></dl></div></div><div class="section" title="IndoorRegulator"><div class="titlepage"><div><div><h3 class="title"><a id="block-IndoorRegulator"></a>IndoorRegulator</h3></div></div></div><p>The IndoorRegulator will adjust its output once every 24 hours, by</p><pre class="programlisting brush: java">   Output[now] = Output[yesterday] + ( Setpoint - Indoor[yesterday] ) * r</pre><p><span class="inlinemediaobject"><img src="images/svg/indoorregulator.svg" alt="IndoorRegulator" /></span></p><div class="table"><a id="idp5290512"></a><p class="title"><strong>Table 14. Inputs</strong></p><div class="table-contents"><table summary="Inputs" border="1" width="50%"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /><col class="col_4" /></colgroup><thead><tr><th align="left" valign="top"> Name    </th><th align="left" valign="top"> Type </th><th align="left" valign="top"> Default </th><th align="left" valign="top"> Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>indoor</p></td><td align="left" valign="top"><p>Double</p></td><td align="left" valign="top"><p>0.0</p></td><td align="left" valign="top"><p>The measured indoor temperature.</p></td></tr><tr><td align="left" valign="top"><p>guide</p></td><td align="left" valign="top"><p>Double</p></td><td align="left" valign="top"><p>0.0</p></td><td align="left" valign="top"><p>The safety guide, which normally comes from an outdoor temperature <a class="xref" href="block-Curve.html" title="Absolute">Curve block</a>.</p></td></tr><tr><td align="left" valign="top"><p>window</p></td><td align="left" valign="top"><p>Double</p></td><td align="left" valign="top"><p>0.0</p></td><td align="left" valign="top"><p>The percentage (%) deviation that the computed output is allowed to be above or below the <span class="emphasis"><em>guide</em></span> value.</p></td></tr><tr><td align="left" valign="top"><p>setpoint</p></td><td align="left" valign="top"><p>Double</p></td><td align="left" valign="top"><p>0.0</p></td><td align="left" valign="top"><p>The setpoint for the <span class="emphasis"><em>indoor</em></span> temperature.</p></td></tr><tr><td align="left" valign="top"><p>r</p></td><td align="left" valign="top"><p>Double</p></td><td align="left" valign="top"><p>0.0</p></td><td align="left" valign="top"><p>The room constant. The <span class="emphasis"><em>output</em></span> is adjusted by r * ( setpoint - measured )</p></td></tr><tr><td align="left" valign="top"><p>enable</p></td><td align="left" valign="top"><p>Boolean</p></td><td align="left" valign="top"><p>false</p></td><td align="left" valign="top"><p>Enables the regulator. If set to false, the <span class="emphasis"><em>guide</em></span> input will be set to the <span class="emphasis"><em>output</em></span>.</p></td></tr></tbody></table></div></div><br class="table-break" /><div class="table"><a id="idp5328560"></a><p class="title"><strong>Table 15. Outputs</strong></p><div class="table-contents"><table summary="Outputs" border="1" width="50%"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /></colgroup><thead><tr><th align="left" valign="top"> Name </th><th align="left" valign="top"> Type </th><th align="left" valign="top"> Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>Output</p></td><td align="left" valign="top"><p>Double</p></td><td align="left" valign="top"><p>If <span class="emphasis"><em>enable</em></span> is false, or if not a complete 24 hour cycle (i.e. up to 48 hours) has been completed, then the <span class="emphasis"><em>output</em></span> is set to the <span class="emphasis"><em>guide</em></span> input value. Otherwise the <span class="emphasis"><em>output</em></span> will be adjusted at 03:00 local time by the error multiplied by the room constant <span class="emphasis"><em>r</em></span>. The <span class="emphasis"><em>output</em></span> will never deviate <span class="emphasis"><em>window</em></span> % away from the <span class="emphasis"><em>guide</em></span> input value.</p></td></tr><tr><td align="left" valign="top"><p>error</p></td><td align="left" valign="top"><p>Double</p></td><td align="left" valign="top"><p>The difference between the <span class="emphasis"><em>indoor</em></span> measurement and the <span class="emphasis"><em>setpoint</em></span>. A negative value indicates that the <span class="emphasis"><em>indoor</em></span> temperature is below the <span class="emphasis"><em>setpoint</em></span>.</p></td></tr><tr><td align="left" valign="top"><p>curveDiff</p></td><td align="left" valign="top"><p>Double</p></td><td align="left" valign="top"><p>The difference between the <span class="emphasis"><em>guide</em></span> value and the <span class="emphasis"><em>output</em></span>. A negative value indicates that the current <span class="emphasis"><em>output</em></span> is larger than the <span class="emphasis"><em>guide</em></span> value.</p></td></tr><tr><td align="left" valign="top"><p>enabled</p></td><td align="left" valign="top"><p>Boolean</p></td><td align="left" valign="top"><p><span class="emphasis"><em>Enabled</em></span> is false either when the <span class="emphasis"><em>enable</em></span> input is false, or if 24 hours sampling of <span class="emphasis"><em>indoor</em></span> has not completed yet. This sampling will start at the first 03:00 and conclude 24 hours later. So up to 48 hours of delay may occur before the <a class="xref" href="block-IndoorRegulator.html" title="IndoorRegulator">IndoorRegulator block</a> starts its room regulator.</p></td></tr></tbody></table></div></div><br class="table-break" /><div class="section" title="Alarms"><div class="titlepage"><div><div><h4 class="title"><a id="_alarms"></a>Alarms</h4></div></div></div><p>If the computed <span class="emphasis"><em>output</em></span> is outside the <span class="emphasis"><em>window</em></span> of the <span class="emphasis"><em>guide</em></span>, then a <span class="emphasis"><em>D class</em></span> and <span class="emphasis"><em>energy</em></span> category alarm will be
sent. The name of the alarm is the name of this block, and the condition describes the error.</p></div><div class="section" title="Description"><div class="titlepage"><div><div><h4 class="title"><a id="_description_8"></a>Description</h4></div></div></div></div><div class="section" title="indoor"><div class="titlepage"><div><div><h4 class="title"><a id="_indoor"></a>indoor</h4></div></div></div></div><div class="section" title="setpoint"><div class="titlepage"><div><div><h4 class="title"><a id="_setpoint"></a>setpoint</h4></div></div></div></div><div class="section" title="r"><div class="titlepage"><div><div><h4 class="title"><a id="_r"></a>r</h4></div></div></div></div><div class="section" title="guide"><div class="titlepage"><div><div><h4 class="title"><a id="_guide"></a>guide</h4></div></div></div></div><div class="section" title="window"><div class="titlepage"><div><div><h4 class="title"><a id="_window"></a>window</h4></div></div></div></div><div class="section" title="enable"><div class="titlepage"><div><div><h4 class="title"><a id="_enable"></a>enable</h4></div></div></div></div><div class="section" title="output"><div class="titlepage"><div><div><h4 class="title"><a id="_output_5"></a>output</h4></div></div></div></div><div class="section" title="enabled"><div class="titlepage"><div><div><h4 class="title"><a id="_enabled"></a>enabled</h4></div></div></div></div><div class="section" title="error"><div class="titlepage"><div><div><h4 class="title"><a id="_error"></a>error</h4></div></div></div></div><div class="section" title="curveDiff"><div class="titlepage"><div><div><h4 class="title"><a id="_curvediff"></a>curveDiff</h4></div></div></div></div><div class="section" title="Source Code"><div class="titlepage"><div><div><h4 class="title"><a id="_source_code_7"></a>Source Code</h4></div></div></div><p>The code for this block is unfortunately significantly large to not easily make sense here. It has therefor
been modified here to show the intent, but the actual details are somewhat different.</p><pre class="programlisting brush: java">    public void update( boolean forceOutput )
    {
        double guideValue = guide.get();
        if( !enable.get() || yesterdayAverage.isNaN() )
        {
            enabled.set( Boolean.FALSE );
            output.set( guideValue );
            roomComputedOutput = output.get();
        }
        else
        {
            double deviation = guideValue * window().get() / 100;
            double minValue = guideValue - deviation;
            double maxValue = guideValue + deviation;
            if( roomComputedOutput &gt; maxValue )
            {
                output.set( maxValue );
                if( condition == null )
                {
                    condition = roomComputedOutput + " &gt; " + maxValue + " (" + guideValue + "/" + deviation + ")";
                    AlarmActivationEvent event = new AlarmActivationEvent( name, condition, "D", "energy" );
                    bus.send( name, event );
                }
            }
            else if( roomComputedOutput &lt; minValue )
            {
                output.set( minValue );
                if( condition == null )
                {
                    condition = roomComputedOutput + " &lt; " + minValue + " (" + guideValue + "/" + deviation + ")";
                    AlarmActivationEvent event = new AlarmActivationEvent( name, condition, "D", "energy" );
                    bus.send( name, event );
                }
            }
            else if( roomComputedOutput &lt; maxValue - 1.0 &amp;&amp; roomComputedOutput &gt; minValue + 1.0 )
            {
                if( condition != null )
                {
                    AlarmDeactivationEvent event = new AlarmDeactivationEvent( name, condition, "D", "energy" );
                    bus.send( name, event );
                    condition = null;
                }
                output.set( roomComputedOutput );
            }
            enabled.set( Boolean.TRUE );
            error.set( indoor.get() - setpoint.get() );
            curveDiff.set( guideValue - output.get() );
        }
    }

    // This method is called once every 24 hours, after the initial start up period is over.
    void updateRegulator()
    {
        yesterdayAverage = indoorSum / indoorCounter;
        indoorSum = 0.0f;
        indoorCounter = 0;
        nextTime = nextTime.plusHours( 24 );
        if( !yesterdayAverage.isNaN() &amp;&amp; enable.get() )
        {
            roomComputedOutput = roomComputedOutput + ( setpoint.get() - yesterdayAverage ) * r.get();
        }
        update( false );
    }</pre></div></div><div xmlns="" xmlns:exsl="http://exslt.org/common" class="footer">(c) 2012-2013 Bali Automation</div></body></html>
